---
title: "Olympics_EDA"
author: "LNT"
date: "2/23/2020"
output:
  rmdformats::readthedown:
    highlight: kate
    code_folding: hide
---


```{r setup, echo=FALSE, cache=FALSE}
library(knitr)
library(rmdformats)

## Global options
options(max.print="75")
opts_chunk$set(echo=FALSE,
	             cache=TRUE,
               prompt=FALSE,
               tidy=TRUE,
               comment=NA,
               message=FALSE,
               warning=FALSE)
opts_knit$set(width=75)
```

```{r basicfcn, include=F}
loadPkg = function(x) { if (!require(x,character.only=T, quietly =T)) { install.packages(x,dep=T,repos="http://cran.us.r-project.org"); if(!require(x,character.only=T, quietly = T)) stop("Package not found") } }
```

```{r Q1, include=T}
# Load data
# 
# https://www.kaggle.com/heesoo37/120-years-of-olympic-history-athletes-and-results
athletes <- read.csv("athlete_events.csv") 

colnames(athletes)
str(athletes)



```
# Find the statistics (summary) of the heights, weights, and ages of all Olympic Athletes 

```{r data_subset, echo=F} 
loadPkg("dplyr")

#subsetting athletes based on unique ID
athletes2 <- subset(athletes, !duplicated(ID))

#subsetting athletes data by removing where weight, height, and age = NA
athletes3 <- subset(athletes2, !is.na(athletes2$Weight) & !is.na(!is.na(athletes2$Height)) & !is.na(athletes2$Age) & !is.na(athletes2$Sex))

#Number of athletes = 100033
athletes <- athletes3
```



```{r weight,eval=FALSE}
#plot athletes weight to visually check normality of weight data
loadPkg("ggplot2")
w <- ggplot(athletes, aes(x=Weight, fill=Sex))

#histogram of weight by gender
w + geom_histogram(color="darkblue") + xlab("weight (kg)") 

boxplot(athletes$Weight, main="Boxplot of Olympians weight", ylab="weight (kg)", col = 'steelblue' )
qqnorm(athletes$Weight, main="Q-Q plot of Olympians weight") 
qqline(athletes$Weight)

# Unable to use Shapiro-Wilk test for normality because sample size must be between 3 and 5000

#reject the null hypothesis if p < 0.05.
weight_normality <- ks.test(athletes$Weight,pnorm) # Kolmogorov-Smirnov Tests against normal distribution
weight_normality


```


## Height 
```{r Height}
loadPkg("ggplot2")
h <- ggplot(athletes, aes(x=Height, fill=Sex)) 

#historgram of height broken down by gender
h + geom_histogram(color="gray7") + xlab("height (cm)")

boxplot(athletes$Height, main="Boxplot of Olympians Height", ylab="Height (cm)", col = 'tomato4' )
qqnorm(athletes$Height, main="Q-Q plot of Olympians weight") 
qqline(athletes$Height)
# Unable to use Shapiro-Wilk test for normality because sample size must be between 3 and 5000
ks.test(athletes$Height,pnorm) # Kolmogorov-Smirnov Tests against normal distribution
```


## Age 
```{r Age,eval=FALSE}


a <- ggplot(athletes, aes(x=Age, fill=Sex)) 

#historgram of height broken down by gender
a + geom_histogram(color="gray7") + xlab("age (cm)")

boxplot(athletes$Age, main="Boxplot of Olympians Age", ylab="Age (cm)", col = 'Beige' )
qqnorm(athletes$Age, main="Q-Q plot of Olympians Age") 
qqline(athletes$Age)
# Unable to use Shapiro-Wilk test for normality because sample size must be between 3 and 5000
ks.test(athletes$Age,pnorm) # Kolmogorov-Smirnov Tests against normal distribution


```

```{r outlierKD2}
# Fix outliers
outlierKD2 <- function(df, var, rm=FALSE) { 
    #' Original outlierKD functino by By Klodian Dhana,
    #' https://www.r-bloggers.com/identify-describe-plot-and-remove-the-outliers-from-the-dataset/
    #' Check outliers, and option to remove them, save as a new dataframe. 
    #' @param df The dataframe.
    #' @param var The variable in the dataframe to be checked for outliers
    #' @param rm Boolean. Whether to remove outliers or not.
    #' @return The dataframe with outliers replaced by NA if rm==TRUE, or df if nothing changed
    #' @examples
    #' outlierKD2(mydf, height, FALSE)
    #' mydf = outlierKD2(mydf, height, TRUE)
    #' mydfnew = outlierKD2(mydf, height, TRUE)
    dt = df # duplicate the dataframe for potential alteration
    var_name <- eval(substitute(var),eval(dt))
    na1 <- sum(is.na(var_name))
    m1 <- mean(var_name, na.rm = T)
    par(mfrow=c(2, 2), oma=c(0,0,3,0))
    boxplot(var_name, main="With outliers")
    hist(var_name, main="With outliers", xlab=NA, ylab=NA)
    outlier <- boxplot.stats(var_name)$out
    mo <- mean(outlier)
    var_name <- ifelse(var_name %in% outlier, NA, var_name)
    boxplot(var_name, main="Without outliers")
    hist(var_name, main="Without outliers", xlab=NA, ylab=NA)
    title("Outlier Check", outer=TRUE)
    na2 <- sum(is.na(var_name))
    cat("Outliers identified:", na2 - na1, "\n")
    cat("Propotion (%) of outliers:", round((na2 - na1) / sum(!is.na(var_name))*100, 1), "\n")
    cat("Mean of the outliers:", round(mo, 2), "\n")
    m2 <- mean(var_name, na.rm = T)
    cat("Mean without removing outliers:", round(m1, 2), "\n")
    cat("Mean if we remove outliers:", round(m2, 2), "\n")
    
    # response <- readline(prompt="Do you want to remove outliers and to replace with NA? [yes/no]: ")
    # if(response == "y" | response == "yes"){
    if(rm){
        dt[as.character(substitute(var))] <- invisible(var_name)
        #assign(as.character(as.list(match.call())$dt), dt, envir = .GlobalEnv)
        cat("Outliers successfully removed", "\n")
        return(invisible(dt))
    } else {
        cat("Nothing changed", "\n")
        return(invisible(df))
    }
}
```

## Remove Outliers or Weight and Age
```{r removeWeightOutliers, results='hide'}
athletes = outlierKD2(athletes,Weight,TRUE)
athletes = outlierKD2(athletes,Age,TRUE)

```



## Replot graphs after Weight data clean up of outliers
```{r replot_weight}
a1 <- ggplot(athletes, aes(x=Weight, fill=Sex)) 

#historgram of height broken down by gender
a1 + geom_histogram(color="gray7", binwidth = 4) + xlab("Weight (kg)")



boxplot(athletes$Weight, main="Boxplot of Olympians Weight", ylab="Weight (kg)", col = 'orange' )
qqnorm(athletes$Weight, main="Q-Q plot of Olympians Weight") 
qqline(athletes$Weight)

```


## Replot graphs after Age data clean up of outliers
```{r replot_Age}
a1 <- ggplot(athletes, aes(x=Age, fill=Sex)) 

#historgram of height broken down by gender
a1 + geom_histogram(color="gray7", binwidth = 1) + xlab("age")

boxplot(athletes$Age, main="Boxplot of Olympians Age", ylab="Age", col = 'orange' )
qqnorm(athletes$Age, main="Q-Q plot of Olympians Age") 
qqline(athletes$Age)

```



```{r bmi}
adult_athletes <- athletes %>% filter(Age>=18)
  
#bmi = weight (kg) / [height (m)]^2
adult_athletes[["BMI"]] <- (adult_athletes$Weight/adult_athletes$Height/adult_athletes$Height) * 10000





```

```{r bmi_02, echo=F}

adult_athletes <- adult_athletes  %>% mutate(BMI_Category = case_when(
  adult_athletes $BMI < 18.5 ~ 1,
  adult_athletes $BMI >= 18.5 & adult_athletes $BMI < 25 ~ 2,
  adult_athletes $BMI >= 25 & adult_athletes $BMI < 30 ~ 3,
  TRUE ~ 4
))

adult_athletes$BMI_Category <- as.factor(adult_athletes$BMI_Category)


```








```{r male_avg}
male_athletes <- subset(adult_athletes,Sex=="M")

maledf <- male_athletes %>% group_by(Sport) %>% summarise_at(vars(Height, Weight,BMI), funs(mean(.,na.rm = TRUE)))

shortest_male <- head(maledf[order(maledf$Height),],10)
tallest_male <- tail(maledf[order(maledf$Height),],10)

lightest_male <- head(maledf[order(maledf$Weight),],10)
heaviest_male <- tail(maledf[order(maledf$Weight),],10)

#historgram of height broken down by gender
ggplot(male_athletes, aes(x=BMI, fill=BMI_Category))  + geom_histogram(color="gray7") + labs(title="Body Mass Index (BMI) of Male Olympic Athletes Over 18 years old", y="Population", x="BMI") + scale_fill_discrete(name="", labels=c("Underweight", "Normal", "Overweight", "Obese"))

```


```{r female_avg}
female_athletes <- subset(adult_athletes, Sex=="F")
femaledf <- female_athletes %>% group_by(Sport) %>% summarise_at(vars(Height, Weight,BMI), funs(mean(.,na.rm = TRUE)))

shortest_female <-head(femaledf[order(femaledf$Height),],10)
tallest_female <- tail(femaledf[order(femaledf$Height),],10)

lightest_female <- head(femaledf[order(femaledf$Weight),],10)
heaviest_female <- tail(femaledf[order(femaledf$Weight),],10)

#historgram of height broken down by gender
ggplot(female_athletes, aes(x=BMI, fill=BMI_Category))  + geom_histogram(color="gray7") + labs(title="Body Mass Index (BMI) of Female Olympic Athletes Over 18 years old", y="Population", x="BMI") + scale_fill_discrete(name="", labels=c("Underweight", "Normal", "Overweight", "Obese"))

```


```{r scatterplot}

  ggplot(adult_athletes,aes(Height, Weight, col=Sex)) + 
    geom_point() + 
    geom_smooth(method="lm")


```



### Construct T-Intervals for BMI for Male and Female Athletes at the 0.95 level

```{r t-intervals}
tinterval.bmi.c95.male = t.test(x=male_athletes$BMI, conf.level=0.95)
tinterval.bmi.c95.female = t.test(x=female_athletes$BMI, conf.level=0.95)

```
***
Variable |      Gender          | level 0.99 |
---------|----------------------|------------|
BMI      | Sex  = M | [`r format(tinterval.bmi.c95.male$conf.int,digits=5)`] 
BMI     | Sex = F  | [`r format(tinterval.bmi.c95.female$conf.int,digits=5)`]  




```{r medal_athletes}
medal_athletes <- subset(athletes, Medal == "Gold" | Medal == "Silver" | Medal == "Bronze")


gold_medals <- subset(athletes, Medal == "Gold")
silver_medals <- subset(athletes, Medal == "Silver")
bronze_medals <- subset(athletes, Medal == "Bronze")

```


