---
title: "Olympics_EDA"
author: "LNT"
date: "1/31/2020"
output:
  rmdformats::readthedown:
    highlight: kate
    code_folding: hide
---


```{r setup, echo=FALSE, cache=FALSE}
library(knitr)
library(rmdformats)

## Global options
options(max.print="75")
opts_chunk$set(echo=FALSE,
	             cache=TRUE,
               prompt=FALSE,
               tidy=TRUE,
               comment=NA,
               message=FALSE,
               warning=FALSE)
opts_knit$set(width=75)
```

```{r basicfcn, include=F}
loadPkg = function(x) { if (!require(x,character.only=T, quietly =T)) { install.packages(x,dep=T,repos="http://cran.us.r-project.org"); if(!require(x,character.only=T, quietly = T)) stop("Package not found") } }
```

```{r Q1, include=T}
# Load data
# 
athletes <- read.csv("athlete_events.csv") 

colnames(athletes)


```
# Find the statistics (summary) of the heights, weights, and ages of all Olympic Athletes 

```{r data_subset, echo=F} 
loadPkg("dplyr")

#subsetting athletes based on unique ID
athletes2 <- subset(athletes, !duplicated(ID))

#subsetting athletes data by removing where weight, height, and age = NA
athletes3 <- subset(athletes2, !is.na(athletes2$Weight) & !is.na(!is.na(athletes2$Height)) & !is.na(athletes2$Age) & !is.na(athletes2$Sex))
athletes4 <- subset(athletes2,na.rm= TRUE)

NROW(athletes3)
NROW(athletes4)

#Number of athletes = 100033
athletes <- athletes3

dim(athletes)
summary(athletes$Height)
summary(athletes$Weight)
summary(athletes$Age)
```



```{r weight}
#plot athletes weight to visually check normality of weight data
loadPkg("ggplot2")

hist(athletes$Weight, main="Histogram of Olympians weight", xlab="Weight (kg)", col = 'green' )
boxplot(athletes$Weight, main="Boxplot of Olympians weight", ylab="Weight (kg)", col = 'red' )
qqnorm(athletes$Weight, main="Q-Q plot of Olympians weight") 
qqline(athletes$Weight)


#shapiro.test(athletes$Weight) # Unable to use Shapiro-Wilk test for normality because sample size must be between 3 and 5000

#reject the null hypothesis if p < 0.05.
weight_normality <- ks.test(athletes$Weight,pnorm) # Kolmogorov-Smirnov Tests against normal distribution
weight_normality


```


## Height 
```{r Height, echo=F}
hist(athletes$Height, main="Histogram of Olympians Height", xlab="Height (cm)", col = 'blue' )
boxplot(athletes$Height, main="Boxplot of Olympians Height", ylab="Height (cm)", col = 'orange' )
qqnorm(athletes$Height, main="Q-Q plot of Olympians weight") 
qqline(athletes$Height)
# Unable to use Shapiro-Wilk test for normality because sample size must be between 3 and 5000
ks.test(athletes$Height,pnorm) # Kolmogorov-Smirnov Tests against normal distribution


```
## Age 
```{r Age, echo=F}
hist(athletes$Age, main="Histogram of Olympians Age", xlab="Age (years)", col = 'Purple' )
boxplot(athletes$Age, main="Boxplot of Olympians Age", ylab="Age (cm)", col = 'Beige' )
qqnorm(athletes$Age, main="Q-Q plot of Olympians Age") 
qqline(athletes$Age)
# Unable to use Shapiro-Wilk test for normality because sample size must be between 3 and 5000
ks.test(athletes$Age,pnorm) # Kolmogorov-Smirnov Tests against normal distribution


```

```{r outlierKD2}
# Fix outliers
outlierKD2 <- function(df, var, rm=FALSE) { 
    #' Original outlierKD functino by By Klodian Dhana,
    #' https://www.r-bloggers.com/identify-describe-plot-and-remove-the-outliers-from-the-dataset/
    #' Check outliers, and option to remove them, save as a new dataframe. 
    #' @param df The dataframe.
    #' @param var The variable in the dataframe to be checked for outliers
    #' @param rm Boolean. Whether to remove outliers or not.
    #' @return The dataframe with outliers replaced by NA if rm==TRUE, or df if nothing changed
    #' @examples
    #' outlierKD2(mydf, height, FALSE)
    #' mydf = outlierKD2(mydf, height, TRUE)
    #' mydfnew = outlierKD2(mydf, height, TRUE)
    dt = df # duplicate the dataframe for potential alteration
    var_name <- eval(substitute(var),eval(dt))
    na1 <- sum(is.na(var_name))
    m1 <- mean(var_name, na.rm = T)
    par(mfrow=c(2, 2), oma=c(0,0,3,0))
    boxplot(var_name, main="With outliers")
    hist(var_name, main="With outliers", xlab=NA, ylab=NA)
    outlier <- boxplot.stats(var_name)$out
    mo <- mean(outlier)
    var_name <- ifelse(var_name %in% outlier, NA, var_name)
    boxplot(var_name, main="Without outliers")
    hist(var_name, main="Without outliers", xlab=NA, ylab=NA)
    title("Outlier Check", outer=TRUE)
    na2 <- sum(is.na(var_name))
    cat("Outliers identified:", na2 - na1, "\n")
    cat("Propotion (%) of outliers:", round((na2 - na1) / sum(!is.na(var_name))*100, 1), "\n")
    cat("Mean of the outliers:", round(mo, 2), "\n")
    m2 <- mean(var_name, na.rm = T)
    cat("Mean without removing outliers:", round(m1, 2), "\n")
    cat("Mean if we remove outliers:", round(m2, 2), "\n")
    
    # response <- readline(prompt="Do you want to remove outliers and to replace with NA? [yes/no]: ")
    # if(response == "y" | response == "yes"){
    if(rm){
        dt[as.character(substitute(var))] <- invisible(var_name)
        #assign(as.character(as.list(match.call())$dt), dt, envir = .GlobalEnv)
        cat("Outliers successfully removed", "\n")
        return(invisible(dt))
    } else {
        cat("Nothing changed", "\n")
        return(invisible(df))
    }
}
```

## Remove Outliers or Weight and Age
```{r removeWeightOutliers}
athletes = outlierKD2(athletes,Weight,TRUE)
athletes = outlierKD2(athletes,Age,TRUE)

```
```{r redo_weight}

ks.test(athletes$Weight,pnorm)
qqnorm(athletes$Weight, main="Q-Q plot of Weight of Olympians \nwith outliers removed") 
qqline(athletes$Weight)
```

```{r redo_age}

ks.test(athletes$Age,pnorm)
qqnorm(athletes$Age, main="Q-Q plot of Age of Olympians \nwith outliers removed") 
qqline(athletes$Age)
```

```{r EDA2}
sd.height <- sd(athletes$Height, na.rm=TRUE)
mean.height <- mean(athletes$Height, na.rm = TRUE)

sd.weight <- sd(athletes$Weight, na.rm = TRUE)
mean.weight <- mean(athletes$Weight, na.rm = TRUE)


```
Standard deviation height `r sd.height`
Mean height `r mean.height`
Standard deviation weight `r sd.weight`
Mean Weight `r mean.weight`



```{r, echo=TRUE}
var(athletes$Height, na.rm = T)
mean(athletes$Height, na.rm = T)
sd(athletes$Height, na.rm = T)
```

```{r}
z80height <- (80-mean.height)/sd.height
z80height
```

```{r, echo = F}
pnorm(z80height) # pnorm to find the probability
qnorm(pnorm(z80height)) # qnorm to find the z-value, the inverse of pnorm.  In this case, the answer is just z80height
```
## Remove records with NA in Height and Weigth
```{r, echo=TRUE}
athletes$zheight = scale(athletes$Height)
athletes$zweight = scale(athletes$Weight)
```

```{r, echo=F}
mean(athletes$zheight, na.rm = TRUE)
sd(athletes$zheight, na.rm = TRUE)

summary(athletes$zheight)
summary(athletes$zweight)
```
## Replot graphs after Height data clean up of
```{r replot_weight}
hist(athletes$Weight, main="Histogram of Olympians Weight", xlab="Weight (kg)", col = 'blue' )
boxplot(athletes$Weight, main="Boxplot of Olympians Weight", ylab="Weight (kg)", col = 'orange' )
qqnorm(athletes$Weight, main="Q-Q plot of Olympians weight") 
qqline(athletes$Weight)

```


## Replot graphs after Age data clean up of
```{r replot_Age}
hist(athletes$Age, main="Histogram of Olympians Age", xlab="Age", col = 'blue' )
boxplot(athletes$Age, main="Boxplot of Olympians Age", ylab="Age", col = 'orange' )
qqnorm(athletes$Age, main="Q-Q plot of Olympians Age") 
qqline(athletes$Age)

```
```{r age}
```



```{r, echo = F, message=FALSE, warning=FALSE}
loadPkg("Hmisc") # this package contains the describe function below
describe(athletes$Weight)
describe(athletes$Height)
```
```{r medal}
gold_medals <- subset(athletes, Medal == "Gold")
silver_medals <- subset(athletes, Medal == "Silver")
bronze_medals <- subset(athletes, Medal == "Bronze")

gold_medals[["bmi"]] <- (gold_medals$Weight/gold_medals$Height/gold_medals$Height) * 10000

silver_medals[["bmi"]] <- (silver_medals$Weight/silver_medals$Height/silver_medals$Height) * 10000

bronze_medals[["bmi"]] <- (bronze_medals$Weight/bronze_medals$Height/bronze_medals$Height) * 10000
summary(gold_medals$Height)
summary(silver_medals$Height)
summary(bronze_medals$Height)
```

# Weight
## Gold, Silver and Bronze Medal Athletes
```{r Weight, echo=F}
summary(gold_medals$Weight)
summary(silver_medals$Weight)
summary(bronze_medals$Weight)
```

# BMI 
## Gold, Silver and Bronze Medal Athletes
```{r BMI}
summary(gold_medals$bmi)
summary(silver_medals$bmi)
summary(bronze_medals$bmi)
```
```{r loading,echo=F}

```

## Gold Medal Athletes BMI
```{r gold, echo=F}

boxplot(gold_medals$bmi, main="Gold Medal Athletes BMI", ylab="weight (lbs)", col='gold')
hist(gold_medals$bmi, main="Gold Medal BMI", col = 'Gold' ) 

```
## Silver Medal Athletes BMI
```{r silver, echo =F}

boxplot(silver_medals$bmi, main="Silver Medal Athletes BMI", ylab="BMI", col='gray')
hist(silver_medals$bmi, main="Silver Medal Athletes BMI", col = 'gray' ) 
```
## Bronze Medal Athletes BMI
```{r bronze, echo=F}

boxplot(bronze_medals$bmi, main="Bronze Medal Athletes BMI", ylab="BMI", col='brown')

hist(bronze_medals$bmi, main="Bronze Medal Athletes BMI", col = 'brown' )
```
```{r scatter, echo=F}

summer_gold <- subset (gold_medals, gold_medals$Season == "Summer" && Sport != "Art Competitions")
winter_gold <- subset (gold_medals, gold_medals$Season == "Winter")


ggplot(data=summer_gold)+
  geom_point(mapping = aes(x=Weight, y=Height, color=Sport))+
  ggtitle("Scatter plot of Summer Gold Medalists Height vs Weight")

ggplot(data=winter_gold)+
  geom_point(mapping = aes(x=Weight, y=Height, color=Sport))
  ggtitle("Scatter plot of Winter Gold Medalists Height vs Weight")



```

# How do Olympic athletes with medals measure up in BMI?
```{r removeDups, echo=F}

medal_athletes <- subset(athletes, !is.na(Medal))
dim(medal_athletes)
medal_athletes[["BMI"]] <- (medal_athletes$Weight/gold_medals$Height/gold_medals$Height) * 10000



medal_athletes <- medal_athletes %>% mutate(Category = case_when(
  medal_athletes$BMI < 18.5 ~ "Underweight",
  medal_athletes$BMI >= 18.5 & medal_athletes$BMI < 25 ~ "Normal Weight",
  medal_athletes$BMI >= 25 & medal_athletes$BMI < 30 ~ "Overweight",
  TRUE ~ "Obese"
))

ggplot(data=medal_athletes, aes(x=Category, y=Age, fill=Sex))+ geom_boxplot()
                

df <- medal_athletes[,c("ID", "Category")]
df <- df %>% group_by(Category) %>% tally()

barplot(df$n, names.arg=c("Underweight", "Normal", "Overweight", "Obese"), col= "green")

g <- ggplot(medal_athletes, aes(x=Age, y=BMI, fill=Sex))

# Scatterplot
g + geom_point() + 
  geom_smooth(method="lm", se=F) +
  labs( 
       y="Age", 
       x="BMI", 
       title="Scatter plot of Age vs BMI")
```
```{r corr}
loadPkg("ggcorrplot")
df1 <- medal_athletes[,c("Age", "Height", "Weight", "BMI")]
df1 <- na.omit(df1)


# Correlation matrix
corr <- round(cor(df1), 1)

# Plot
ggcorrplot(corr, hc.order = TRUE, 
           type = "lower", 
           lab = TRUE, 
           #lab_size = 3, 
           method="circle", 
           title="medal_athletes", 
           ggtheme=theme_bw)


```
